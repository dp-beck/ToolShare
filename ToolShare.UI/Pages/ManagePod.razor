@page "/manage-pod/{podId:int}"
@using AutoMapper.Execution

@if (!_isLoading)
{
    <h3>Manage Pod: @Pod.Name</h3>

    <p>Hi @Pod.podManager.UserName, you are the manager of this pod. You can change pod name, add new pod members, remove users from pod transfer management to another user, or delete the pod.</p>
    
    <h4>Change Pod Name</h4>
    <EditForm Model="@NewPodName" OnSubmit="HandleEditSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div class="form-group row m-3">
            <label for="PodName" class="col-sm-2 col-form-label"> Name: </label>
            <div class="col-sm-10">
                <InputText class="form-control" id="PodName" @bind-Value="NewPodName" />
            </div>
        </div>
        
        <div class="form-group row m-3">
            <div class="col-sm-10">
                <button type="submit" class="btn btn-primary">Submit Changes</button>
            </div>
        </div>

    </EditForm>
    
    <h4>Add User to Pod</h4>
    
    <MudDataGrid Items="@NoPodUsers">
        <TemplateColumn Title="Photo">
            <CellTemplate>
                <img src="@context.Item.ProfilePhotoUrl" alt="picture of the user" width="50px"/>    
            </CellTemplate>
        </TemplateColumn>
        
        <TemplateColumn Title="UserName">
            <CellTemplate>
                <a class="nav-link" href="user-detail/@context.Item.UserName">@context.Item.UserName</a>    
            </CellTemplate>
            
        </TemplateColumn>
        <PropertyColumn Property="NoPodUser => NoPodUser.FirstName" Title="First Name"></PropertyColumn>
        <PropertyColumn Property="NoPodUser => NoPodUser.LastName" Title="Last Name"></PropertyColumn>
        <TemplateColumn Title="">
            <CellTemplate>
                <button @onclick="async () => await HandleAddUserClick(context.Item.UserName)">Add?</button>
            </CellTemplate>
        </TemplateColumn>
    </MudDataGrid>

    <h4>Remove Pod Members</h4>
    <p>Make this a Grid of Pod Members with Photo, Username, First Name, Last Name, Button to Remove from Pod</p>
    <MudDataGrid Items="@Pod.PodMembers.AsQueryable()">
        <TemplateColumn Title="Photo">
            <CellTemplate>
                <img src="@context.Item.ProfilePhotoUrl" alt="picture of the user" width="50px"/>
            </CellTemplate>
        </TemplateColumn>
        <TemplateColumn Title="UserName">
            <CellTemplate>
                <a class="nav-link" href="user-detail/@context.Item.UserName">@context.Item.UserName</a>    
            </CellTemplate>
        </TemplateColumn>
        <PropertyColumn Property="PodMember => PodMember.FirstName" Title="First Name"></PropertyColumn>
        <PropertyColumn Property="PodMember => PodMember.LastName" Title="Last Name"></PropertyColumn>
        <TemplateColumn Title="">
            <CellTemplate>
                <button @onclick="async () => await HandleRemoveMemberClick(context.Item.UserName)">Delete?</button>    
            </CellTemplate>
        </TemplateColumn>
    </MudDataGrid>
    
    <h4>Choose a new Pod Manager</h4>
    <p>Make this a drop down menu of pod members, selecting will change the manager
        Require another button press to make it happen </p>
    
    <EditForm Model="@NewPodManagerName" OnSubmit="HandleChangeManagerClick">
        <div class="form-group row m-3">
            <label for="NewPodManager" class="col-sm-2 col-form-label"> Choose New Pod Manager: </label>
            <div class="col-sm-10">
                <InputSelect class="form-control" id="NewPodManager" @bind-Value="NewPodManagerName">
                    @foreach (var member in Pod.PodMembers)
                    {
                        <option value="@member.UserName">@member.UserName</option>
                    }
                </InputSelect>
            </div>
        </div>
        
        <div class="form-group row m-3">
            <div class="col-sm-10">
                <button type="submit" class="btn btn-primary">Submit Changes</button>
            </div>
        </div>

    </EditForm>
    <h4>Delete Pod</h4>
    <p>Note! You cannot delete your pod until you have removed all other users from the pod. Please note
        that by deleting the pod you manage, you delete your account from the app as well!</p>
    <button type="button" class="btn btn-danger" @onclick="HandleDelete">Delete Pod</button>

}